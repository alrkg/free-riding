# DNS 응답 미수신 문제 분석

현재 클라이언트와 프록시 서버는 동일한 네트워크 상에 있으며, 아래와 같은 방식으로 패킷 전송을 수행하고 있습니다.

1) 클라이언트는 원본 패킷의 이더넷 헤더 뒤에 **가짜 IP + TCP 헤더**를 삽입하여 프록시 서버의 0번 포트로 전송합니다.  
가짜 패킷 구조 : (Ethernet + 가짜 IP + 가짜 TCP/UDP + Ethernet 헤더를 제외한 원본 패킷)

2) 프록시 서버는 해당 패킷에서 가짜 IP/TCP 헤더를 제거한 후, **출발지 MAC은 그대로 유지**하고 **목적지 MAC만 게이트웨이의 MAC 주소로 수정**하여 원본 목적지로 패킷을 전달합니다.

이 방식으로 프록시 서버가 원본 목적지로 패킷을 전달하는 과정까지는 Wireshark를 통해 정상적으로 확인되었습니다. 그러나 DNS 패킷의 경우, 응답이 클라이언트에 도달하지 않는 문제가 발생하고 있습니다.

## 패킷 캡처 비교

| 클라이언트 측 캡처 | 프록시 서버 측 캡처 |
|--------------------|----------------------|
|![client](https://github.com/user-attachments/assets/eb44c04a-69d5-420d-8324-9b9667539341)|![proxy-server](https://github.com/user-attachments/assets/c86b6de2-f5a5-4271-8526-8782963137e7)


- 좌측은 클라이언트에서 전송된 패킷
- 우측은 프록시 서버가 클라이언트로부터 패킷을 받은 후, 수정하여 전송한 패킷

이 두 개의 `.pcapng` 파일은 packet_captures 폴더에 올려두었습니다.

---
## 문제점

DNS 응답은 프록시 서버를 거치지 않고, DNS 서버에서 클라이언트로 직접 전달되도록 의도했습니다. 하지만 클라이언트에서 응답을 받지 못하고 있는 상황입니다.

### 의심되는 원인

- DNS 서버가 응답을 전송할 때, MAC 주소가 클라이언트와 일치하지 않아 문제가 발생하는 것일까 생각이 들어, 프록시 서버에서 패킷을 수정할 때 출발지 MAC 주소를 클라이언트의 MAC 주소로 변경해 시도해보았지만, 여전히 동일한 문제가 발생

- 방화벽 또는 필터링 정책이 응답 패킷을 차단
